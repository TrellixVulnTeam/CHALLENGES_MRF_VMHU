"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.descend = exports.summarize = exports.index = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _collection = require("./collection");

/* Helpers */

/* Exports */
var index = function index(collection) {
  for (var _len = arguments.length, indexKeys = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
    indexKeys[_key - 1] = arguments[_key];
  }

  indexKeys.reverse();
  return _collection.merge.apply(void 0, (0, _toConsumableArray2["default"])((0, _collection.values)((0, _collection.map)(collection, function (item) {
    return indexKeys.reduce(function (agg, key) {
      return (0, _defineProperty2["default"])({}, item[key], agg);
    }, item);
  }))));
};

exports.index = index;

var summarize = function summarize(collection, summarizer) {
  for (var _len2 = arguments.length, indexKeys = new Array(_len2 > 2 ? _len2 - 2 : 0), _key2 = 2; _key2 < _len2; _key2++) {
    indexKeys[_key2 - 2] = arguments[_key2];
  }

  indexKeys.reverse();
  return _collection.merge.apply(void 0, (0, _toConsumableArray2["default"])((0, _collection.values)((0, _collection.map)(collection, function (item) {
    return indexKeys.reduce(function (agg, key) {
      return (0, _defineProperty2["default"])({}, item[key], agg);
    }, summarizer(item));
  }))));
};

exports.summarize = summarize;

var descend = function descend(collection, process, level) {
  return level ? (0, _collection.map)(collection, function (item) {
    return descend(item, process, level - 1);
  }) : (0, _collection.map)(collection, process);
};

exports.descend = descend;